# HelpMeChat 操作手册

## 简介

HelpMeChat 是一款专为微信用户设计的智能助手应用程序。它通过监控微信输入框，当用户输入特定触发字符（">>"）时，自动弹出回复选择窗口，提供预设回复选项和 AI 生成的智能回复，帮助用户快速完成微信对话。

### 主要功能
- **实时监控**：自动检测微信输入框的输入变化。
- **预设回复**：提供多种常用回复模板。
- **AI 智能生成**：集成 Ollama AI 服务，根据聊天历史生成个性化回复。
- **自定义提示词**：支持用户添加自定义提示词，增强 AI 生成质量。
- **用户记忆**：记住用户的偏好设置，如最后使用的回复类型和 AI 配置。
- **图形界面**：直观的 WPF 界面，支持拖拽和透明窗口。

## 系统要求

- **操作系统**：Windows 10 或更高版本。
- **.NET 运行时**：.NET 8.0 或更高版本。
- **内存**：至少 4GB RAM。
- **存储空间**：至少 100MB 可用空间。
- **外部依赖**：
  - Ollama：必须安装，用于 AI 回复生成（默认地址：http://127.0.0.1:11434/api）。
  - 微信 PC 客户端 3.9.12.57：用于监控和输入回复。

## 安装步骤

1. **下载应用程序**：
   - 从 GitHub 仓库下载最新版本的 HelpMeChat。
   - 或者克隆仓库并编译项目：
     ```
     git clone https://github.com/jau-huei/HelpMeChat.git
     cd HelpMeChat
     dotnet build --configuration Release
     ```

2. **安装依赖**：
   - 确保已安装 .NET 8.0 SDK。
   - 安装 Ollama：
     - 下载并安装 Ollama 从 [ollama.ai](https://ollama.ai)。
     - 启动 Ollama 服务：`ollama serve`。
     - 下载并运行 AI 模型，例如：`ollama run kimi-k2:1t-cloud` 或其他支持的模型。

3. **配置应用程序**：
   - 首次运行时，应用程序会自动创建 `config.json` 文件。
   - 编辑 `config.json` 配置 Ollama 服务地址、模型名称等。

## 配置说明

### 基本配置
编辑 `config.json` 文件：

```json
{
  "WeChatUserName": "你的微信用户名",
  "OllamaService": "http://127.0.0.1:11434/api",
  "Model": "kimi-k2:1t-cloud",
  "WeChatDbPath": "C:\\Users\\用户名\\Documents\\WeChat Files\\微信ID\\Msg\\MicroMsg.db",
  "WeChatId": "你的微信ID",
  "AiContextMessageCount": 100,
  "Prompt": "系统提示词...",
  "PresetReplies": {
    "感谢回复": "好的，谢谢你的提醒！我会尽快处理的。",
    // ... 其他预设回复
  },
  "AiConfigs": [
    {
      "Name": "同事",
      "IsShared": true,
      "Prompt": "你是我的智能助理，负责帮我补全微信消息。你代表我本人，与对方是同事关系..."
    },
    // ... 其他 AI 配置
  ]
}
```

- **WeChatUserName**：你的微信用户名，用于 AI 了解身份。
- **OllamaService**：Ollama API 服务地址。
- **Model**：使用的 AI 模型名称。
- **WeChatDbPath**：微信数据库路径，用于读取聊天历史。
- **WeChatId**：微信 ID。
- **AiContextMessageCount**：AI 生成时参考的历史消息数量。
- **Prompt**：通用系统提示词。
- **PresetReplies**：预设回复字典。
- **AiConfigs**：AI 配置列表，每个配置包含名称、是否共享和专用提示词。

### 微信数据库路径查找
1. 打开微信 PC 客户端。
2. 登录你的微信账号。
3. 数据库路径通常位于：`C:\Users\用户名\Documents\WeChat Files\微信ID\Msg\MicroMsg.db`。
4. 将路径复制到 `config.json` 中的 `WeChatDbPath`。

## 使用方法

### 启动应用程序
1. 运行 `HelpMeChat.exe`。
2. 主窗口显示配置界面，确认设置正确。
3. 点击"开始监控"按钮启动微信监控。

### 监控微信
- 应用程序会自动监控微信输入框。
- 当你在微信中输入 ">>" 时，系统会弹出回复选择窗口。
- 窗口显示预设回复选项和 AI 生成选项。

### 选择回复
1. **预设回复**：
   - 在下拉列表中选择预设回复。
   - 点击"使用回复"按钮，将回复插入微信输入框。

2. **AI 生成回复**：
   - 选择 AI 配置（同事、朋友等）。
   - 点击"生成 AI 回复"按钮（播放图标）。
   - 等待 AI 生成回复，生成过程中按钮显示暂停图标，可点击取消。
   - 生成完成后，点击"使用回复"按钮（打钩图标）插入回复。

3. **自定义提示词**：
   - 在输入框中输入自定义提示词。
   - 点击生成按钮时，自定义提示词会合并到系统提示中。
   - 历史提示词会自动保存，最多保留 10 个。

### 记忆功能
- 应用程序会记住每个用户的最后选择：
  - 最后使用的预设回复。
  - 最后选择的 AI 配置。
  - 最后使用的标签页（预设或 AI）。
- 记忆保存在 `memories.json` 文件中。

## 功能详解

### UI 自动化监控
- 使用 FlaUI 库监控微信 UI 变化。
- 支持事件驱动和轮询回退机制。
- 检测输入框焦点和内容变化。

### AI 回复生成
- 基于 Ollama API 生成回复。
- 支持多种 AI 配置，适应不同关系（同事、朋友、客户等）。
- 根据聊天历史和自定义提示词生成个性化回复。

### 自定义提示词
- 用户可在输入框中添加自定义提示词。
- 提示词全局共享，所有用户可见。
- 支持键盘快捷键（已移除，需手动输入）。

### 预设回复
- 提供 15 种常用回复模板。
- 支持快速选择和应用。

## 故障排除

### 常见问题

1. **无法弹出回复窗口**：
   - 检查微信是否正在运行。
   - 确认输入框监控是否启动。
   - 检查配置文件中的微信数据库路径是否正确。

2. **AI 生成失败**：
   - 确认 Ollama 服务正在运行。
   - 检查网络连接。
   - 验证模型是否已下载：`ollama list`。

3. **配置不生效**：
   - 重启应用程序。
   - 检查 `config.json` 语法是否正确。

4. **内存或性能问题**：
   - 减少 `AiContextMessageCount` 值。
   - 关闭不必要的应用程序。

### 日志查看
- 应用程序会在控制台输出调试信息。
- 检查 Windows 事件查看器中的错误日志。

## 更新和支持

### 更新应用程序
- 从 GitHub 仓库下载最新版本。
- 备份 `config.json` 和 `memories.json` 文件。
- 替换可执行文件后恢复配置文件。

### 获取帮助
- 查看 GitHub Issues：https://github.com/jau-huei/HelpMeChat/issues
- 提交问题或建议。

### 许可证
本项目采用 MIT 许可证。详见 LICENSE 文件。

---

**版本**：1.0.0  
**最后更新**：2025年10月13日  
**作者**：jau-huei